<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <title>Document</title>
</head>
<body>
    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î     -->
    <div class="wrap">
        <div class="sidebar">   
            <div class="sidebar-header">
                <img src="{{ url_for('static', filename='image/dap_only_logo.png') }}" />
                <div class="logo-text">
                    <div class="logo-title">DAP</div>
                    <div class="logo-subtitle">Data Access Platform</div>
                </div>
            </div>

            {% if user_info.ADMIN_ROLE != "SYSTEM" %}
                <ul class="sidebar-links">
                    <div class="menu-title">Î©îÎâ¥</div>

                    {% set is_active = request.endpoint == 'new_chat' %}
                    {% set icon_color = '047857' if is_active else '000000' %}

                    <li class="menu-item" id="new_chat" data-session-id="{{ chat_session_id }}">
                        <a href="{{ url_for('new_chat') }}" style="text-decoration:none; color:inherit;">
                            <img src="https://img.icons8.com/?size=100&id=TA4QF-Vb1AiX&format=png&color={{ icon_color }}" />
                            <span>ÏÉàÎ°úÏö¥ Ï±ÑÌåÖ</span>
                        </a>
                    </li>

                    {% set is_active = request.endpoint == 'view_favorite_page' %}
                    {% set icon_color = '047857' if is_active else '000000' %}

                    <li class="menu-item" id="favorite">
                    
                        <a href="{{ url_for('view_favorite_page') }}" style="text-decoration:none; color:inherit;">
                            <img src="https://img.icons8.com/?size=100&id=43879&format=png&color={{ icon_color }}" />
                            <span>Ï¶êÍ≤®Ï∞æÍ∏∞</span>
                        </a>
                    </li>
                
                    <br>
                    
                    <div class="menu-title">ÏµúÍ∑º Í∏∞Î°ù</div>
                    {% if user_chat_list %}
                        {% for chat in user_chat_list %}
                            <li class="menu-item">
                                <a href="{{ url_for('view_already_chat_page', chat_session_id=chat.CHAT_SESSION_ID) }}">
                                    <img src="https://img.icons8.com/?size=100&id=20106&format=png&color=000000" />
                                    <span>{{ chat.QUESTION_TEXT }}</span>
                                </a>
                            </li>
                        {% endfor %}
                    {% endif %}
                </ul>
            {% else %}
                <ul class="sidebar-links">
                    <div class="menu-title">ÏãúÏä§ÌÖú Í¥ÄÎ¶¨Ïûê Î©îÎâ¥</div>
                    {% set is_active = request.endpoint == 'view_system_log_page' %}
                    {% set icon_color = '047857' if is_active else '000000' %}

                    <li class="menu-item {% if is_active %}active{% endif %}">
                        <a href="{{ url_for('view_system_log_page') }}">
                            <img src="https://img.icons8.com/?size=100&id=CsbD6WKBWxtf&format=png&color={{ icon_color }}" />
                            <span>ÏãúÏä§ÌÖú Î°úÍ∑∏</span>
                        </a>
                    </li>
                    
                    {% set is_active = request.endpoint == 'view_manage_role_page' %}
                    {% set icon_color = '047857' if is_active else '000000' %}

                    <li class="menu-item" id="manage_role">
                        <a href="{{ url_for('view_manage_role_page') }}" style="text-decoration:none; color:inherit;">
                            <img src="https://img.icons8.com/?size=100&id=6xyw5cLpMNLR&format=png&color={{ icon_color }}" />
                            <span>Í∂åÌïú Í¥ÄÎ¶¨</span>
                        </a>
                    </li>
                </ul>
            {% endif %}
            <div class="user-section">
                <div class="user-info">

                    {% if user_info.ADMIN_ROLE == "CLINICAL" %}
                    <img class="user-icon"
                        src="https://img.icons8.com/?size=100&id=9TmDmAtqEdVZ&format=png&color=000000">

                    {% elif user_info.ADMIN_ROLE == "ADMINISTRATION" %}
                    <img class="user-icon"
                        src="https://img.icons8.com/?size=100&id=aFxfm4qI75vj&format=png&color=000000">

                    {% elif user_info.ADMIN_ROLE == "RESEARCHER"%}
                    <img class="user-icon"
                        src="https://img.icons8.com/?size=100&id=Jy6voCYpThrR&format=png&color=000000">

                    {% else %}
                    <img class="user-icon"
                        src="https://img.icons8.com/?size=100&id=vIvqEz5cC70m&format=png&color=000000">

                    {% endif %}

                    <div class="user-text">
                    <div class="user-name">
                        {{ user_info.USER_NAME }}
                    </div>
                    <div class="user-role">
                        {{ user_info.ADMIN_ROLE }} Admin
                    </div>
                    </div>

                </div>

                <div class="logout-wrapper">
                    <a href="/logout">
                    <img class="logout-icon"
                        src="https://img.icons8.com/?size=100&id=vGj0AluRnTSa&format=png&color=000000">
                    </a>
                </div>
            </div>
        </div>
        
        {% if user_info.ADMIN_ROLE != "SYSTEM" %}
            <div class="main-content">
                <!-- ÎßåÏïΩ Ï±ÑÌåÖÏù¥ ÏûàÏúºÎ©¥ -->
                {% if chat_blocks %}
                <div class="yes_chat">
                    <div class="chatting">
                    {% for block in chat_blocks %}

                    <div class="human-question">
                        {{ block.question }}
                    </div>
                    <div class="llm-answer_include_retry">
                        <div class="llm-answer">
                            {% if block.answer %}
                            <div class="llm-answer-char">
                                {{ block.answer }}
                            </div>
                            {% endif %}

                            {% if block.table %}
                            <div class="llm-table">
                                <table class="result-table">
                                    <thead>
                                        <tr>
                                            {% for col in block.table.columns %}
                                            <th>{{ col }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in block.table.rows %}
                                        <tr>
                                            {% for value in row %}
                                            <td>{{ value }}</td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>

                                <button
                                    class="detail-button"
                                    data-url="{{ url_for('popup', answer_id=block.answer_id) }}"
                                    onclick="openPopup(this.dataset.url)">
                                    <img src="https://img.icons8.com/?size=100&id=98955&format=png&color=000000" />
                                    ÏûêÏÑ∏ÌûàÎ≥¥Í∏∞
                                </button>
                            </div>
                            {% endif %}
                        
                        <a class="retry">
                            <img src="https://img.icons8.com/?size=100&id=88634&format=png&color=999999"/>
                        </a>
                        </div>
                    </div>
                    {% endfor %}
                    </div>

                    <form class="chat-search-box" method="post">
                        <img
                        class="chat-search-icon"
                        src="https://img.icons8.com/?size=100&id=7695&format=png&color=94A3BB"
                        />
                        <input type="text" placeholder="Í∂ÅÍ∏àÌïú Í≤ÉÏùÑ ÏßàÎ¨∏ÌïòÏÑ∏Ïöî" name="human_question"/>
                        <button class="chat-search-button" type="submit">
                        <img src="https://img.icons8.com/?size=100&id=deb0U2CNzMat&format=png&color=FFFFFF"/>
                        </button>
                    </form>
                </div>
                
                <!-- ÎßåÏïΩ Ï¶êÍ≤®Ï∞æÍ∏∞ ÎàÑÎ•¥Î©¥ -->
                {% elif is_favorite %}
                <form class="favorite_list" method="POST" action="{{ url_for('view_favorite_page') }}">
                    <div class="fav-header">
                        <h1 class="page-title">Ï¶êÍ≤®Ï∞æÍ∏∞</h1>
                        <div class="header-actions">
                            <button class="action-btn" type="button" onclick="toggleAllByButton()">
                                <img 
                                src="https://img.icons8.com/?size=100&id=924&format=png&color=000000" 
                                alt="check" 
                                style="width: 14px; height: 14px;" 
                                />
                                Ï†ÑÏ≤¥ ÏÑ†ÌÉù
                            </button>

                            <button class="action-btn delete" type="submit">
                                <img 
                                src="https://img.icons8.com/?size=100&id=PziI2kHf4XFz&format=png&color=000000" 
                                alt="delete" 
                                style="width: 14px; height: 14px;" 
                                />
                                ÏÇ≠Ï†ú
                            </button>
                        </div>
                    </div>

                    <div class="fav-container">
                        <div class="tbody_style">
                            <table class="fav-table">
                            <thead>
                                <tr>
                                <th class="col-check">
                                    <input type="checkbox" id="check-all" onchange="toggleAll(this.checked)" 
                                    />
                                </th> 
                                <th class="col-content">ÏßàÏùò ÎÇ¥Ïö©</th>
                                <th class="col-date">Ïã§Ìñâ ÏãúÍ∞Ñ</th>
                                </tr>
                            </thead>
                            
                            {% if fav_list %}
                            <tbody>
                                {% for fav_info in fav_list %}
                                <tr>
                                    <td class="col-check"><input type="checkbox" name="fav_ids" value="{{ fav_info.SAVED_QUERY_ID }}"/></td>
                                    <td class="col-content">
                                        <div class="content-wrapper">
                                            <span>
                                                <a href="{{ url_for('popup', answer_id=fav_info.QUESTION_ID) }}" class="fav_popup">{{ fav_info.TITLE }}</a>
                                            </span>
                                        </div>
                                    </td>
                                    <td class="col-date">{{ fav_info.CREATED_AT }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            {% endif %}
                            
                            </table>
                        </div>

                        <div class="pagination-footer">
                            <div class="page-info">Ï†ÑÏ≤¥ {{ total_list }}Í±¥</div>
                            <div class="pagination-controls">
                                <div class="pagination-controls">
                                    <!-- Ïù¥Ï†Ñ -->
                                    <a class="page-btn prev {% if page == 1 %}disabled{% endif %}"
                                    href="?page={{ page - 1 }}">
                                        &lt;
                                    </a>

                                    <!-- ÌéòÏù¥ÏßÄ Î≤àÌò∏ -->
                                    {% for p in range(1, total_pages + 1) %}
                                        <a class="page-btn {% if p == page %}active{% endif %}"
                                        href="?page={{ p }}">
                                            {{ p }}
                                        </a>
                                    {% endfor %}

                                    <!-- Îã§Ïùå -->
                                    <a class="page-btn next {% if page == total_pages %}disabled{% endif %}"
                                    href="?page={{ page + 1 }}">
                                        &gt;
                                    </a>
                                                        
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- ÎßåÏïΩ Ï±ÑÌåÖÏ∞ΩÏù¥ÎÇò Îã§Î•∏ Í≤ÉÏúºÎ°ú Î∞îÎÄåÎ©¥ -->
                {% else %}
                <div class="no_chat">
                    <div class="center-area">
                        <!-- Ï§ëÏïô ÏïÑÏù¥ÏΩò -->
                        <div class="hero-icon">
                            <img src="{{ url_for('static', filename='image/dap_only_logo.png') }}"/>
                        </div>

                        <!-- ÏÑ§Î™Ö Î¨∏Íµ¨ -->
                        <div class="hero-text">
                            ÏùºÏÉÅÏ†ÅÏù∏ Ïñ∏Ïñ¥Î°ú Î≥µÏû°Ìïú ÏùòÎ£å Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º Ï°∞ÌöåÌï† Ïàò ÏûàÎèÑÎ°ù ÏßÄÏõêÌï©ÎãàÎã§
                        </div>

                        <!-- Í≤ÄÏÉâÎ∞î -->
                        <form class="search-box" method="post">
                            <img
                            class="search-icon"
                            src="https://img.icons8.com/?size=100&id=7695&format=png&color=94A3BB"
                            />
                            <input type="text" placeholder="Í∂ÅÍ∏àÌïú Í≤ÉÏùÑ ÏßàÎ¨∏ÌïòÏÑ∏Ïöî" name="human_question"/>
                            <button class="search-button" type="submit">
                            <img src="https://img.icons8.com/?size=100&id=deb0U2CNzMat&format=png&color=000000"/>
                            </button>
                        </form>

                        <!-- ÏòàÏãú ÏßàÎ¨∏ -->
                        <div class="suggestion-area">
                            <span>Îã§ÏùåÍ≥º Í∞ôÏùÄ Í≤ÉÏùÑ Ï∞æÏùÑ Ïàò ÏûàÏäµÎãàÎã§:</span>

                            <button class="suggestion-chip">
                            ÌèâÍ∑† ICU Ïû¨ÏõêÏùº Ïàò
                            </button>

                            <button class="suggestion-chip">
                            ÏõîÎ≥Ñ ÌôòÏûê Ïàò
                            </button>

                            <button class="suggestion-chip">
                            ÎÇòÏù¥ÎåÄÎ≥Ñ ICU ÌôòÏûê Î∂ÑÌè¨
                            </button>
                        </div>

                        <!-- ÌïòÎã® Î≥¥Ïïà ÏïàÎÇ¥ -->
                        <div class="feature-area">

                            <div class="feature-item">
                            <div class="feature-icon">
                            <img src="https://img.icons8.com/?size=100&id=94&format=png&color=059669" />
                            </div>
                            <div class="feature-title">Secure Processing</div>
                            <div class="feature-desc">
                            Íµ≠Ï†ú ÏùòÎ£å Î≥¥Ïïà Í∏∞Ï§ÄÏùÑ Ï§ÄÏàòÌïòÎ©∞<br />
                            Îç∞Ïù¥ÌÑ∞Îäî ÏïàÏ†ÑÌïú ÌôòÍ≤Ω ÎÇ¥ÏóêÏÑúÎßå Ï≤òÎ¶¨Îê©ÎãàÎã§.
                            </div>
                        </div>

                            <div class="feature-item">
                            <div class="feature-icon">
                            <img src="https://img.icons8.com/?size=100&id=96151&format=png&color=059669" />
                            </div>
                            <div class="feature-title">Secure Processing</div>
                            <div class="feature-desc">
                            Í∞úÏù∏Ï†ïÎ≥¥Îäî ÏûêÎèôÏúºÎ°ú Í∞êÏßÄÎêòÏñ¥<br />
                                Í≤∞Í≥ºÏóêÏÑú ÎßàÏä§ÌÇπÎê©ÎãàÎã§.
                            </div>
                        </div>
                    
                            <div class="feature-item">
                            <div class="feature-icon">
                            <img src="https://img.icons8.com/?size=100&id=iWXaTX0OHmpB&format=png&color=059669" />
                            </div>
                            <div class="feature-title">Secure Processing</div>
                            <div class="feature-desc">
                            ÏãúÏä§ÌÖúÏùÄ Ï°∞Ìöå Ï†ÑÏö©ÏúºÎ°ú ÎèôÏûëÌïòÏó¨<br />
                                Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤ΩÏùÑ Î∞©ÏßÄÌï©ÎãàÎã§.
                            </div>
                        </div>
                        </div>

                    </div>
                </div>
                {% endif %}
            </div>

        {% else %}
            <div class="main-content">
            {% if system_loc %}
                <div class="system_log_dashboard">
                    <div class="content-header">
                        <h1 class="page-title">ÏãúÏä§ÌÖú Î™®ÎãàÌÑ∞ÎßÅ</h1>
                        <!-- <div class="header-actions">
                        <button class="btn btn-green">‚¨á Îã§Ïö¥Î°úÎìú</button>
                        </div> -->
                    </div>

                    <div class="dashboard-grid">
                        <div class="metrics-column">
            
                        <div class="card metric-card">
                            <div class="card-label">Ï†ÑÏ≤¥ ÏøºÎ¶¨ Ïàò</div>
                            <div class="metric-right">
                            <div class="card-value">{{ "{:,}".format(latest_query_count) }}</div>
                            <div class="card-trend up">
                                <span>{{ query_count_per }}% ÏÉÅÏäπ</span>
                            </div>
                            </div>
                        </div>

                        <div class="card metric-card">
                            <div class="card-label">ÌèâÍ∑† ÏÉùÏÑ± ÏãúÍ∞Ñ</div>
                            <div class="metric-right">
                            <div class="card-value">{{ latest_avg_query_time }}s</div>
                            <div class="card-trend down">
                                <span>{{ avg_query_time_per | abs }}Ï¥à 
                                    {% if avg_query_time_per > 0 %}
                                        Í∞êÏÜå
                                    {% else %}
                                        Ï¶ùÍ∞Ä
                                    {% endif %}
                                </span>
                            </div>
                            </div>
                        </div>

                        <div class="card metric-card">
                            <div class="card-label">CPU ÏÇ¨Ïö©Î•†</div>
                            <div class="metric-right">       
                            <div class="card-value">{{ cpu_use }}%</div>
                            <div class="card-trend down">
                                <span>{{ cpu_use_diff }}% Í∞êÏÜå</span>
                            </div>
                            </div>
                        </div>

                        <div class="card metric-card">
                            <div class="card-label">Slow Query (‚â•30s)</div>
                            <div class="metric-right">       
                            <div class="card-value">{{ slow_query_count }}Í±¥</div>
                            <div class="card-trend down">
                                <span>{{ slow_query_diff | abs }}Í±¥
                                    {% if slow_query_diff > 0 %}
                                        Ï¶ùÍ∞Ä
                                    {% else %}
                                        Í∞êÏÜå
                                    {% endif %}
                                </span>
                            </div>
                            </div>
                        </div>

                        </div>

                        <div class="card chart-card">
                        <div class="chart-header">
                            <div class="chart-title-group">
                            <span class="card-label">ÏøºÎ¶¨ ÏöîÏ≤≠Îüâ Ï∂îÏù¥</span>
                            <div class="chart-value-row">
                                <span class="chart-big-value">1,420/hr</span>
                                <span class="chart-sub-text">ÏµúÎåÄ ÏÇ¨Ïö©Îüâ</span>
                            </div>
                            </div>
                        </div>
                        
                
                        {% if query_graph_html %}
                        <div class="chart-container">
                            {{ query_graph_html | safe }}
                        </div>
                        {% endif %}
                   

                        <!-- <div class="chart-labels">
                            <span>08:00</span><span>12:00</span><span>16:00</span><span>20:00</span><span>00:00</span>
                        </div> -->
                        </div>
                    </div>
                    
                    <div class="card table-card">               
                        <h1 class="page-title2">ÏµúÍ∑º 1ÏãúÍ∞Ñ ÎèôÏïà Í∞ÄÏû• Ïò§Îûò Í±∏Î¶∞ ÏøºÎ¶¨ top 5</h1>         
                        <div class="table-wrapper">
                        <table class="fav-table">
                            <thead>
                            <tr>
                                <th width="45%">SESSION ID</th>
                                <th width="15%">QUERY ID</th>
                                <th width="25%">ÏÉùÏÑ± ÏãúÍ∞Ñ</th>
                                <th width="15%">Ïã§Ìñâ ÏãúÍ∞Ñ</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for row in top_5_query_rows %}
                                <tr>
                                    {% for cell in row %}
                                        <td>{{ cell }}</td>
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        </div>

                       
                    </div>
                </div>
            {% else %}
                <div class="manage_role_dashboard">
                    <h2>ÏÇ¨Ïö©Ïûê Í∂åÌïú Í¥ÄÎ¶¨</h2>
                    <div class="table_all_cover">
                    <form class="role-container" method="post" action="{{ url_for('view_manage_role_page') }}">
                        <button
                            type="submit"
                            class="choose_user_role {% if role == 'CLINICAL' %}is-active{% endif %}"
                            name="role"
                            value="CLINICAL"
                            aria-selected="{{ 'true' if role == 'CLINICAL' else 'false' }}"
                        >
                            ÏùòÏÇ¨ (Doctor)
                        </button>

                        <button
                            type="submit"
                            class="choose_user_role {% if role == 'RESEARCHER' %}is-active{% endif %}"
                            name="role"
                            value="RESEARCHER"
                            aria-selected="{{ 'true' if role == 'RESEARCHER' else 'false' }}"
                        >
                            Ïó∞Íµ¨Ïõê (Researcher)
                        </button>

                        <button
                            type="submit"
                            class="choose_user_role {% if role == 'ADMINISTRATION' %}is-active{% endif %}"
                            name="role"
                            value="ADMINISTRATION"
                            aria-selected="{{ 'true' if role == 'ADMINISTRATION' else 'false' }}"
                        >
                            ÌñâÏ†ï (Administration)
                        </button>
                    </form>


                    <div class="tbody_style2">
                        <table class="role-table">
                            <thead>
                                <tr>
                                <th>ÏÇ¨Ïö©Ïûê</th>
                                <th>Î∂ÄÏÑúÎ™Ö</th>
                                <th>ÎßàÏßÄÎßâ Î°úÍ∑∏Ïù∏ ÏãúÍ∞Ñ</th>
                                <th>ÏÉÅÌÉú</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in selected_role_user_list %}
                                <tr>
                                    <td>{{ row.USER_NAME }}</td>
                                    <td>{{ row.DEPARTMENT }}</td>
                                    <td>{{ row.TIME_DIFF }}</td>
                                    <td>
                                        <form method="post" action="/manage_role">
                                            <label class="switch">
                                                <input
                                                    type="checkbox"
                                                    class="status-toggle"
                                                    data-user-seq="{{ row.USER_SEQ }}"
                                                    {% if row.IS_ACTIVE == 'Y' %}checked{% endif %}
                                                >
                                                <span class="slider"></span>
                                                <span class="label-text">
                                                    {% if row.IS_ACTIVE == 'Y' %}ÌôúÏÑ±Ìôî{% else %}ÎπÑÌôúÏÑ±Ìôî{% endif %}
                                                </span>
                                            </label>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="role-pagination-footer">
                        <div class="page-info">Ï†ÑÏ≤¥ {{ total_list }}Í±¥</div>

                            <div class="pagination-controls">

                                <!-- Ïù¥Ï†Ñ -->
                                <a class="page-btn prev {% if page == 1 %}disabled{% endif %}"
                                href="{{ url_for('view_manage_role_page', page=page-1, role=role) }}">
                                    &lt;
                                </a>

                                <!-- ÌéòÏù¥ÏßÄ Î≤àÌò∏ -->
                                {% for p in range(1, total_pages + 1) %}
                                    <a class="page-btn {% if p == page %}active{% endif %}"
                                    href="{{ url_for('view_manage_role_page', page=p, role=role) }}">
                                        {{ p }}
                                    </a>
                                {% endfor %}

                                <!-- Îã§Ïùå -->
                                <a class="page-btn next {% if page == total_pages %}disabled{% endif %}"
                                href="{{ url_for('view_manage_role_page', page=page+1, role=role) }}">
                                    &gt;
                                </a>

                            </div>
                            
                        </div>

                       
                    </div>
                {% endif %}
                </div>
            {% endif %}
            
        
        </div>

    <!-- ‚úÖ ÎîîÎ≤ÑÍπÖ: pending_answer_id Í∞í ÌôïÏù∏ -->
    <script>
    console.log('üîç pending_answer_id =', {{ pending_answer_id if pending_answer_id else 'null' }});
    </script>

    {% if pending_answer_id %}
    <script>
    // LLM ÎãµÎ≥Ä ÏÉùÏÑ± ÏÉÅÌÉúÎ•º Ï£ºÍ∏∞Ï†ÅÏúºÎ°ú ÌôïÏù∏ÌïòÎäî Ìè¥ÎßÅ Î°úÏßÅ
    (function() {
        const answerId = {{ pending_answer_id }};
        
        console.log('üîÑ Ìè¥ÎßÅ ÏãúÏûë: answer_id=' + answerId);
        
        function checkStatus() {
            console.log('‚è∞ ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...');
            fetch(`/check_answer_status/${answerId}`)
                .then(res => res.json())
                .then(data => {
                    console.log('üì• ÏùëÎãµ:', data);
                    if (data.status === 'complete') {
                        // ‚úÖ ÏôÑÎ£åÎêòÎ©¥ ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®
                        console.log('‚úÖ LLM ÎãµÎ≥Ä ÏÉùÏÑ± ÏôÑÎ£å, ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®');
                        window.location.reload();
                    } else {
                        // ‚è≥ ÏïÑÏßÅ ÏßÑÌñâ Ï§ëÏù¥Î©¥ 3Ï¥à ÌõÑ Îã§Ïãú ÌôïÏù∏
                        console.log('‚è≥ LLM ÎãµÎ≥Ä ÏÉùÏÑ± Ï§ë...');
                        setTimeout(checkStatus, 3000);
                    }
                })
                .catch(err => {
                    console.error('‚ùå Status check failed:', err);
                    // ÏóêÎü¨ ÏãúÏóêÎèÑ Ïû¨ÏãúÎèÑ (ÎÑ§Ìä∏ÏõåÌÅ¨ Î¨∏Ï†ú Îì±)
                    setTimeout(checkStatus, 3000);
                });
        }
        
        // Ï≤´ Ï≤¥ÌÅ¨Îäî 1Ï¥à ÌõÑ ÏãúÏûë
        setTimeout(checkStatus, 1000);
    })();
    </script>
    {% endif %}

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>